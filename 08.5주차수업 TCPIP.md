TCP 하다가 UDP로 넘어가도록 하겠습니다.
UDP는 파라미터값만 조금 바꾸어주면됩니다. 

* 이론에 관련된 얘기는 크게크게 함수로 봐주시기바랍니다

* 대표적인 웹 클라이언트인 인터넷 익스플로러(Internet Explorer)는 사용자가 입력한 주소를 참조해 접속 대기 중인 웹 서버에 접속한 후 HTTP를 이용해 요청메세지(ex, 웹페이지 경로명)를 보낸다. 웹 서버는 인터넷 익스플로러로부터 받은 메시지를 분석한 후 역시 HTTP를 이용해 응답 메시지(ex, 웹페이지데이터)를 다시 보낸다. 인터넷 익스플로러는 웹 서버로부터 받은 데이터를 처리해 화면에 표시한다. HTTP는 TCP에 기반한 프로토콜이므로 웹 서버-클라이언트는 대표적인 TCP 서버-클라이언트 응용 프로그램이라 할 수 있다. 

* 서버 : 클라이언트가 보낸 데이터를 받아서(receive) 이를 문자열로 간주해 무조건 화면에 출력한다(printf). 그리고 받은 데이터를 변경 없이 다시 클라이언트에 보낸다.(Send). 받은 데이터를 그대로 다시 보낸다는 뜻으로 에코 서버(echo server)라 부른다.

* 클라이언트 : 사용자가 키보드로 입력한(fgets) 문자열을 서버에 보낸다(send). 서버가 받은 데이터를 그대로 돌려보내면, 클라이언트는 이를 받아서(recv) 화면에 출력한다.(printf). 에코 서버와 통신한다는 의미로 에코 클라이언트(echo client)라 부른다. 

* 프로토콜 : 통신 규약으로, 소켓을 생성할 때 결정한다.
* 지역(local) IP 주소와 지역 포트 번호 : 서버 또는 클라이언트 자신의 주소다.
* 원격(remote) IP 주소와 원격 포트 번호 : 서버 또는 클라이언트가 통신하는 상대의 주소이다.

* 소켓함수는 (데이터 전송 함수를 제외하면) 지역 주소와 원격 주소를 결정하고 TCP 상태(Listening, Established 등)를 변경하기 위한 일련의 절차라 할 수 있다. 예제에서 사용한 함수를 각각 서버 함수, 클라이언트 함수, 데이터 전송 함수로 구분해 살펴보자. 서버 함수는 서버에서만, 클라이언트 함수는 클라이언트에서만, 데이터 전송 함수는 양쪽에서 사용한다는 차이가 있다.

* TCP 서버는 다음과 같은 순서로 소켓 함수를 호출한다.
1. socket() 함수로 소켓을 생성함으로써 사용할 프로토콜을 결정한다.
2. bind() 함수로 지역 IP주소와 지역 포트 번호를 결정한다. 
3. listen() 함수로 TCP를 LISTENING 상태로 변경한다.
4. accept() 함수로 자신에게 접속한 클라이언트와 통신할 수 있는 새로운 소켓을 생성한다. 이때 원격 IP 주소와 원격 포트 번호가 결정된다.
5. send(), recv() 등의 데이터 전송함수로 클라이언트와 통신을 수행한 후, ㅊlosesocket()함수로 소켓을 닫는다. 
6. 새로운 클라이언트 접속이 들어올 때마다 4~5과정을 반복한다. 

* bind() 함수
1. bind() 함수는 소켓의 지역 IP 주소와 지역 포트 번호를 결정한다.

* 블로킹(blocking) 소켓 : 지금까지 생성한 소켓은 모두 블로킹 소켓이다. 블로킹 소켓을 대상으로 send() 함수를 호출하면, 송신 버퍼의 여유 공간이 send() 함수의 세 번째 인자인 len 보다 작을 경우 해당 프로세스는 대기 상태가 된다. 송신 버퍼에 충분한 공간이 생기면 프로세스는 깨어나고 len 크기만큼 데이터 복사가 일어난 후 sned() 함수가 리턴한다. 이 경우 send() 함수의 리턴 값은 len과 같다. 

* 넌블로킹(nonblocking) 소켓 : iocktlsocket() 함수를 이용하면 블로킹 소켓을 넌블로킹 소켓으로 바꿀 수 있다. 넌블로킹 소켓을 대상으로 send() 함수를 호출하면, 송신버퍼의 여유 공간만큼 데이터를 복사한 후 실제 복사한 바이트 수를 리턴한다. 이 경우 send() 함수의 리턴 값은 최소 1, 최대 len 이다.

# 요약

1. TCP 응용 프로그램의 통신을 위한 다섯 가지 조건
- 프로토콜 : 소켓을 생성할 때 결정하는 통신 규약
- 지역 IP 주소와 지역 포트 번호 : 서버 또는 클라이언트 자신의 주소
- 원격 IP 주소와 운격 포트 번호 : 서버 또는 클라이언트가 통신하는 상대의 주소

2. TCP 서버 핵심 함수
- bind() : 소켓의 지역 IP 주소와 지역 포트 번호 결정
- linetn() : 소켓의 TCP 포트 상태를 LISTENING 으로 변경
- accept() : 접속한 클라이언트와 통신할 수 있는 새로운 소켓을 생성해 리턴. 접속한 클라이언트의 주소 정보도 알려준다.

3. TCP 클라이언트 핵심 함수
- connect() : TCP 프로토콜 수준에서 서버와 논리적 연결 설정

4. 소켓 버퍼
- 송신 버퍼 : 데이터를 전송하기 전에 임시로 저장해두는 영역
- 수신 버퍼 : 받은 데이터를 응용 프로그램이 처리하기 전까지 임시로 저장해두는 영역

5. TCP 데이터 전송 함수
- send() : 응용 프로그램 데이터를 운영체제의 송신 버퍼에 복사함으로써 데이터를 전송. 데이터 복사가 성공하면 곧바로 리턴하므로 send() 함수가 리턴했다고 실제 데이터가 전송된 것은 아니며, 일정 시간이 지나야만 하부 프로토콜(예를 들면, TCP/IP)을 통해 전송이 완료된다. 
- recv() : 운영체제의 수신 버퍼에 도착한 데이터를 응용 프로그램 버퍼에 복사 

6. TCP 응용 프로그램의 두 가지 종료 방식
- 정상 종료 : 사용하던 포트는 일정 시간(5분 이내) TIME_WAIT 상태에 있다가 사라진다.
- 비정상 종료(=강제 종료) : 사용하던 포트는 TIME_WAIT 상태를 거치지 않고 사라진다. 

7. IPv4 코드를 IPv6 코드로 변환하기
- ws2tcpip.h 헤더 파일 포함
- 소켓 생성 시 AF_INET 대신 AF_INET6 사용
- 소켓 주소 구조체로 SOCKADDR_IN 대신 SOCKADDR_IN6 사용
- IPv4만을 지원하는 주소 변환 함수를 IPv4/IPv6 지원 함수로 대체
- 데이터 전송 함수는 기존의 send()/recv() 함수를 변경 없이 그대로 사용한다.
























